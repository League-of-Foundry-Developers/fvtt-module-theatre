/*!
 * @pixi/gif - v2.1.1
 * Compiled Fri, 16 Feb 2024 16:16:32 UTC
 *
 * @pixi/gif is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 * 
 * Copyright 2024, Matt Karl @bigtimebuddy, All Rights Reserved
 */this.PIXI=this.PIXI||{},this.PIXI.gif=function(D,x,K){"use strict";var De=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Z(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ee(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ze(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function Ge(t){if(t.__esModule)return t;var r=t.default;if(typeof r=="function"){var e=function a(){if(this instanceof a){var n=[null];n.push.apply(n,arguments);var s=Function.bind.apply(r,n);return new s}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),e}var k={},E={},I={};Object.defineProperty(I,"__esModule",{value:!0});var J=I.loop=ee=I.conditional=V=I.parse=void 0,Q=function t(r,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:a;if(Array.isArray(e))e.forEach(function(o){return t(r,o,a,n)});else if(typeof e=="function")e(r,a,n,t);else{var s=Object.keys(e)[0];Array.isArray(e[s])?(n[s]={},t(r,e[s],a,n[s])):n[s]=e[s](r,a,n,t)}return a},V=I.parse=Q,W=function(r,e){return function(a,n,s,o){e(a,n,s)&&o(a,r,n,s)}},ee=I.conditional=W,te=function(r,e){return function(a,n,s,o){for(var i=[],c=a.pos;e(a,n,s);){var h={};if(o(a,r,n,h),a.pos===c)break;c=a.pos,i.push(h)}return i}};J=I.loop=te;var p={};Object.defineProperty(p,"__esModule",{value:!0});var re=p.readBits=ve=p.readArray=fe=p.readUnsigned=he=p.readString=ce=p.peekBytes=de=p.readBytes=oe=p.peekByte=ie=p.readByte=ne=p.buildStream=void 0,ae=function(r){return{data:r,pos:0}},ne=p.buildStream=ae,R=function(){return function(r){return r.data[r.pos++]}},ie=p.readByte=R,se=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(e){return e.data[e.pos+r]}},oe=p.peekByte=se,P=function(r){return function(e){return e.data.subarray(e.pos,e.pos+=r)}},de=p.readBytes=P,ue=function(r){return function(e){return e.data.subarray(e.pos,e.pos+r)}},ce=p.peekBytes=ue,le=function(r){return function(e){return Array.from(P(r)(e)).map(function(a){return String.fromCharCode(a)}).join("")}},he=p.readString=le,pe=function(r){return function(e){var a=P(2)(e);return r?(a[1]<<8)+a[0]:(a[0]<<8)+a[1]}},fe=p.readUnsigned=pe,ge=function(r,e){return function(a,n,s){for(var o=typeof e=="function"?e(a,n,s):e,i=P(r),c=new Array(o),h=0;h<o;h++)c[h]=i(a);return c}},ve=p.readArray=ge,ye=function(r,e,a){for(var n=0,s=0;s<a;s++)n+=r[e+s]&&Math.pow(2,a-s-1);return n},me=function(r){return function(e){for(var a=R()(e),n=new Array(8),s=0;s<8;s++)n[7-s]=!!(a&1<<s);return Object.keys(r).reduce(function(o,i){var c=r[i];return c.length?o[i]=ye(n,c.index,c.length):o[i]=n[c.index],o},{})}};re=p.readBits=me,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=I,e=p,a={blocks:function(d){for(var f=0,u=[],w=d.data.length,m=0,v=(0,e.readByte)()(d);v!==f&&v;v=(0,e.readByte)()(d)){if(d.pos+v>=w){var b=w-d.pos;u.push((0,e.readBytes)(b)(d)),m+=b;break}u.push((0,e.readBytes)(v)(d)),m+=v}for(var y=new Uint8Array(m),B=0,_=0;_<u.length;_++)y.set(u[_],B),B+=u[_].length;return y}},n=(0,r.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===249}),s=(0,r.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,e.readArray)(3,function(l,d,f){return Math.pow(2,f.descriptor.lct.size+1)})},function(l,d,f){return f.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},a]}]},function(l){return(0,e.peekByte)()(l)===44}),o=(0,r.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(d,f,u){return(0,e.readBytes)(u.text.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===1}),i=(0,r.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(d,f,u){return(0,e.readString)(u.blockSize)(d)}},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===255}),c=(0,r.conditional)({comment:[{codes:(0,e.readBytes)(2)},a]},function(l){var d=(0,e.peekBytes)(2)(l);return d[0]===33&&d[1]===254}),h=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,r.conditional)({gct:(0,e.readArray)(3,function(l,d){return Math.pow(2,d.lsd.gct.size+1)})},function(l,d){return d.lsd.gct.exists}),{frames:(0,r.loop)([n,i,c,s,o],function(l){var d=(0,e.peekByte)()(l);return d===33||d===44})}],g=h;t.default=g}(E);var Re=Z(E),A={};Object.defineProperty(A,"__esModule",{value:!0});var _e=A.deinterlace=void 0,xe=function(r,e){for(var a=new Array(r.length),n=r.length/e,s=function(d,f){var u=r.slice(f*e,(f+1)*e);a.splice.apply(a,[d*e,e].concat(u))},o=[0,4,2,1],i=[8,8,4,2],c=0,h=0;h<4;h++)for(var g=o[h];g<n;g+=i[h])s(g,c),c++;return a};_e=A.deinterlace=xe;var O={};Object.defineProperty(O,"__esModule",{value:!0});var be=O.lzw=void 0,we=function(r,e,a){var n=4096,s=-1,o=a,i,c,h,g,l,d,f,S,u,w,_,m,F,T,M,j,v=new Array(a),b=new Array(n),y=new Array(n),B=new Array(n+1);for(m=r,c=1<<m,l=c+1,i=c+2,f=s,g=m+1,h=(1<<g)-1,u=0;u<c;u++)b[u]=0,y[u]=u;var _,S,G,F,T,j,M;for(_=S=G=F=T=j=M=0,w=0;w<o;){if(T===0){if(S<g){_+=e[M]<<S,S+=8,M++;continue}if(u=_&h,_>>=g,S-=g,u>i||u==l)break;if(u==c){g=m+1,h=(1<<g)-1,i=c+2,f=s;continue}if(f==s){B[T++]=y[u],f=u,F=u;continue}for(d=u,u==i&&(B[T++]=F,u=f);u>c;)B[T++]=y[u],u=b[u];F=y[u]&255,B[T++]=F,i<n&&(b[i]=f,y[i]=F,i++,!(i&h)&&i<n&&(g++,h+=i)),f=d}T--,v[j++]=B[T],w++}for(w=j;w<o;w++)v[w]=0;return v};be=O.lzw=we,Object.defineProperty(k,"__esModule",{value:!0});var L=k.decompressFrames=Ae=k.decompressFrame=N=k.parseGIF=void 0,Be=ke(E),Te=I,Fe=p,Ie=A,Se=O;function ke(t){return t&&t.__esModule?t:{default:t}}var Ce=function(r){var e=new Uint8Array(r);return(0,Te.parse)((0,Fe.buildStream)(e),Be.default)},N=k.parseGIF=Ce,Pe=function(r){for(var e=r.pixels.length,a=new Uint8ClampedArray(e*4),n=0;n<e;n++){var s=n*4,o=r.pixels[n],i=r.colorTable[o]||[0,0,0];a[s]=i[0],a[s+1]=i[1],a[s+2]=i[2],a[s+3]=o!==r.transparentIndex?255:0}return a},X=function(r,e,a){if(!r.image){console.warn("gif frame does not have associated image.");return}var n=r.image,s=n.descriptor.width*n.descriptor.height,o=(0,Se.lzw)(n.data.minCodeSize,n.data.blocks,s);n.descriptor.lct.interlaced&&(o=(0,Ie.deinterlace)(o,n.descriptor.width));var i={pixels:o,dims:{top:r.image.descriptor.top,left:r.image.descriptor.left,width:r.image.descriptor.width,height:r.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?i.colorTable=n.lct:i.colorTable=e,r.gce&&(i.delay=(r.gce.delay||10)*10,i.disposalType=r.gce.extras.disposal,r.gce.extras.transparentColorGiven&&(i.transparentIndex=r.gce.transparentColorIndex)),a&&(i.patch=Pe(i)),i},Ae=k.decompressFrame=X,Oe=function(r,e){return r.frames.filter(function(a){return a.image}).map(function(a){return X(a,r.gct,e)})};L=k.decompressFrames=Oe;var Ue=Object.defineProperty,U=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,H=(t,r,e)=>r in t?Ue(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,je=(t,r)=>{for(var e in r||(r={}))$.call(r,e)&&H(t,e,r[e]);if(U)for(var e of U(r))q.call(r,e)&&H(t,e,r[e]);return t},Me=(t,r)=>{var e={};for(var a in t)$.call(t,a)&&r.indexOf(a)<0&&(e[a]=t[a]);if(t!=null&&U)for(var a of U(t))r.indexOf(a)<0&&q.call(t,a)&&(e[a]=t[a]);return e};const C=class extends K.Sprite{constructor(t,r){super(x.Texture.EMPTY),this.animationSpeed=1,this.loop=!0,this.duration=0,this.autoPlay=!0,this.dirty=!1,this._currentFrame=0,this._autoUpdate=!1,this._isConnectedToTicker=!1,this._playing=!1,this._currentTime=0;const e=Object.assign({},C.defaultOptions,r),{scaleMode:a,width:n,height:s}=e,o=Me(e,["scaleMode","width","height"]),i=document.createElement("canvas"),c=i.getContext("2d");i.width=n,i.height=s,this.texture=x.Texture.from(i,{scaleMode:a}),this.duration=t[t.length-1].end,this._frames=t,this._context=c,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,o),this.currentFrame=0,o.autoPlay&&this.play()}static fromBuffer(t,r){if(!t||t.byteLength===0)throw new Error("Invalid buffer");const e=m=>{var v;let b=null;for(const y of m.frames)b=(v=y.gce)!=null?v:b,"image"in y&&!("gce"in y)&&(y.gce=b)},a=N(t);e(a);const n=L(a,!0),s=[],o=document.createElement("canvas"),i=o.getContext("2d",{willReadFrequently:!0}),c=document.createElement("canvas"),h=c.getContext("2d");o.width=a.lsd.width,o.height=a.lsd.height;let g=0,l=null;const{fps:d}=Object.assign({},C.defaultOptions,r),f=1e3/d;for(let m=0;m<n.length;m++){const{disposalType:v=2,delay:b=f,patch:y,dims:{width:B,height:_,left:S,top:G}}=n[m];c.width=B,c.height=_,h.clearRect(0,0,B,_);const F=h.createImageData(B,_);F.data.set(y),h.putImageData(F,0,0),v===3&&(l=i.getImageData(0,0,o.width,o.height)),i.drawImage(c,S,G);const T=i.getImageData(0,0,o.width,o.height);v===2?i.clearRect(0,0,o.width,o.height):v===3&&i.putImageData(l,0,0),s.push({start:g,end:g+b,imageData:T}),g+=b}o.width=o.height=0,c.width=c.height=0;const{width:u,height:w}=a.lsd;return new C(s,je({width:u,height:w},r))}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(x.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(x.Ticker.shared.add(this.update,this,x.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0),!this.loop&&this.currentFrame===this._frames.length-1&&(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(t){var r,e;if(!this._playing)return;const a=this.animationSpeed*t/x.settings.TARGET_FPMS,n=this._currentTime+a,s=n%this.duration,o=this._frames.findIndex(i=>i.start<=s&&i.end>s);n>=this.duration?this.loop?(this._currentTime=s,this.updateFrameIndex(o),(r=this.onLoop)==null||r.call(this)):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),(e=this.onComplete)==null||e.call(this),this.stop()):(this._currentTime=s,this.updateFrameIndex(o))}updateFrame(){if(!this.dirty)return;const{imageData:t}=this._frames[this._currentFrame];this._context.putImageData(t,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(t){this.updateFrame(),super._render(t)}_renderCanvas(t){this.updateFrame(),super._renderCanvas(t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(x.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(x.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(t){this.updateFrameIndex(t),this._currentTime=this._frames[t].start}updateFrameIndex(t){var r;if(t<0||t>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${t}`);this._currentFrame!==t&&(this._currentFrame=t,this.dirty=!0,(r=this.onFrameChange)==null||r.call(this,t))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const t=null;this._context=t,this._frames=t,this.onComplete=t,this.onFrameChange=t,this.onLoop=t}clone(){return new C([...this._frames],{autoUpdate:this._autoUpdate,loop:this.loop,autoPlay:this.autoPlay,scaleMode:this.texture.baseTexture.scaleMode,animationSpeed:this.animationSpeed,width:this._context.canvas.width,height:this._context.canvas.height,onComplete:this.onComplete,onFrameChange:this.onFrameChange,onLoop:this.onLoop})}};let z=C;z.defaultOptions={scaleMode:x.SCALE_MODES.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};const Y={extension:x.ExtensionType.Asset,detection:{test:async()=>!0,add:async t=>[...t,"gif"],remove:async t=>t.filter(r=>r!=="gif")},loader:{test:t=>x.utils.path.extname(t)===".gif",load:async(t,r)=>{const e=await(await x.settings.ADAPTER.fetch(t)).arrayBuffer();return z.fromBuffer(e,r==null?void 0:r.data)},unload:async t=>{t.destroy()}}};return x.extensions.add(Y),D.AnimatedGIF=z,D.AnimatedGIFAsset=Y,D}({},PIXI,PIXI);
//# sourceMappingURL=pixi-gif.js.map
